<!DOCTYPE html>
<html class="ui-page-login">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<link href="css/mui.min.css" rel="stylesheet" />
		<link href="css/style.css" rel="stylesheet" />
		<!--图标库-->
		<link rel="stylesheet" type="text/css" href="fonts/font_808468_w2at8z9smbn.css" />
		<link rel="stylesheet" href="css/style.css" />

		<link rel="stylesheet" type="text/css" href="css/login_version.css" />
		<script src="js/jquery-1.11.1.min.js"></script>
		<script src="js/mui.min.js"></script>
		<script src="js/mui.enterfocus.js"></script>
		<script src="js/change_address.js" type="text/javascript" charset="utf-8"></script>
		<style type="text/css">
			.mui-input-row label {
				padding: 0rem 0.15rem;
				height: 1rem;
				line-height: 0.85rem;
			}
			.sub_title{font-size: 12px;color: #999999;}
			#login-form .mui-input-row .iconfont.icon-yanjing{
				top: 50%;
				margin-top: -10px;
			}
		</style>
	</head>
	<body>
		<div class="mui-content" style="    background: #fff;">
			<img src="images/asd_new.png" width="100%" />
			<form id='login-form' class="mui-input-group">
				<div class="mui-input-row" style="border-bottom: 1px solid #eee;">
					<label><i class="iconfont icon-gerenzhongxin"></i></label>
					<!--<input id='username' value="15201103719" type="text" placeholder="请输入账号">-->
					<input id='username' value="" type="text" placeholder="请输入账号">
				</div>
				<div class="mui-input-row">
					<label><i class="iconfont icon-mima"></i></label>
					<input id='password' value="" type="password" class="mui-input-password" placeholder="请输入密码">
					<span class="mui-icon mui-icon-eye iconfont icon-yanjing"></span>
				</div>
			</form>
			<div class="link-area" style=" width: 80%; margin: 0.25rem auto;">
				<span class="left span1">
					<a id="passa" data-remember="1">
						<i class="iconfont icon-weixuanzhongkuang"></i>
						<i class="iconfont icon-xuanzhong" ></i>
						记住密码
					</a>
				</span>
				<span class="right span2">
				 	<a id='forgetPassword' style="color: #378ba4; font-size: 0.25rem;">忘记密码？</a>
				</span>
			</div>
			<div class="mui-content-padded">
				<button id='login' class="mui-btn mui-btn-block mui-btn-primary">立即登录</button>
			</div>
		</div>
		<div class="mui-loading" style="position: fixed;display: none;z-index: 999999;background:rgba(0, 0, 0, 0.14);top: 0;width: 100%;height: 100%;">
			<div class="mui-spinner" style="display: block;margin: 0 auto;margin-top: 5.5rem;"></div>
		</div>
		<div class="edition">
			<div class="infor">
				<div class="pop_content">
					<div class="pop_top">
						<div class="pop_title">发现<span style="font-size: 0.6rem;">新　　</span>　　<span class="bottom_top">版本<br /><span>v.2.0.1</span></span></div>
						
						<div class="pop_updated_content">
							<div class="updated_cont">内容加载中...</div>
						</div>
						<div class="pop_close mui-icon mui-icon-close" onclick="this.parentNode.parentNode.parentNode.parentNode.style.display='none'"></div>
					</div>
					<div class="pop_bottom">
						<button class="pop_button_btn pop_ljsj">立即升级</button>
						<button class="pop_button_btn pop_zzgx">正在更新...</button>
						<div class="pop_div_tip">为了不影响使用，请立即升级！</div>
						<div class="sub_title">当前版本<span id="dqversion"></span></div>
						<div id="demo5" class="mui-progressbar">
							<span></span>
						</div>
					</div>
				</div>
			</div>
		</div>
		<script src="js/rem.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/mui.enterfocus.js"></script>
		<script src="js/app.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/login.js?v=1027"></script>
		<script src="js/version_update.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			function GetRequest(value) {
				//url例子：www.bicycle.com?id="123456"&Name="bicycle"；  
				var url = decodeURI(location.search); //?id="123456"&Name="bicycle";
				var object = {};
				if(url.indexOf("?") != -1) //url中存在问号，也就说有参数。  
				{
					var str = url.substr(1); //得到?后面的字符串
					var strs = str.split("&"); //将得到的参数分隔成数组[id="123456",Name="bicycle"];
					for(var i = 0; i < strs.length; i++) {　　　　　　　　
						object[strs[i].split("=")[0]] = strs[i].split("=")[1]　　　　　　
					}　　
				}
				return object[value];
			}
			document.addEventListener('plusready', function() {
				if(GetRequest("cid") != 1) {
					//前后台事件切换//前台-reception;后台-backstage
					var appswitching = "reception";
					//运行环境从前台切换到后台事件
					document.addEventListener("pause", function(){
						appswitching = "backstage";
					}, false);
					//运行环境从后台切换到前台事件
					document.addEventListener("resume", function(){
						appswitching = "reception";
					}, false);
					//监听系统通知栏消息点击事件  
					// plus.push.addEventListener('click', function(msg) {
					// 	//处理点击消息的业务逻辑代码  
					// 	if (typeof(msg.payload)=="string") {
					// 		var infor = JSON.parse(msg.payload);
					// 	}else{
					// 		var infor = msg.payload;
					// 	}
					// 	jump_infor(infor);
					// }, false);
					
//					var str = {"flow_id":"7","item_id":106,"flow_page_type":"approval","status":true,"title":"闪闪发光","content":"内容content测试"};
//					var options = {cover:false};
//					options.title=str.title;
//					str.status=false;
//					var _str = JSON.stringify(str);
//					plus.push.createMessage(str.content, _str ,options);
					 
					// plus.push.addEventListener('receive', function(msg) {
					// 	//处理透传消息的业务逻辑代码  
					// 	if(plus.os.name=="iOS" ){
					// 		if(appswitching == "backstage"){
					// 			return false;
					// 		}
					// 		if(msg.payload.status){
					// 			try{
					// 				if (typeof(msg.payload)=="string") {
					// 					var str = JSON.parse(msg.payload);
					// 				}else{
					// 					var str = msg.payload;
					// 				}
					// 				str.status=false;
					// 				var options = {cover:false};
					// 				options.title=str.title;
					// 				var _str = JSON.stringify(str);
					// 				plus.push.createMessage(str.content, _str ,options);
					// 			}catch(e){
					// 				//TODO handle the exception
					// 				mui.alert("推送数据出错，请联系管理员解决");
					// 			}
					// 		}
					// 	}else{
					// 		if (typeof(msg.payload)=="string") {
					// 			var infor = JSON.parse(msg.payload);
					// 		}else{
					// 			var infor = msg.payload;
					// 		}
					// 		jump_infor(infor)
					// 	}
						
					// }, false);
				} else {
					//mui.toast("无需进行检测推送消息")
				}
				
			}, false);

			function jump_infor(infor) {
				var infor = infor;
				var flow_id = Number(infor.flow_id);
				switch(flow_id) {
					case 101://即时消息
						mui.openWindow({
							url: "instant_messaging.html",
							id: "instant_messaging.html",
							extras: {
								self_id: infor.self_id
							}
						})
						break;
					case 1: // 收文
					case 2: // 发文
					case 6: // 电话通知
						//发文收文电话通知详情
						mui.openWindow({
							url: 'bumfDetails.html', //通过URL传参
							id: 'bumfDetails.html', //通过URL传参
							extras: {
								item_id: infor.flow_id,
								flow_id: infor.item_id
							}
						})
						break;
					case 3: // 厅级外出报备
					case 7: // 处级外出报备
					case 8: // 普通人员请假
						if(infor.flow_page_type=="approval"){
							//外出报备待处理
							mui.openWindow({
								url: 'leaveDetails_db.html', //通过URL传参
								id: 'leaveDetails_db.html', //通过URL传参
								extras: {
									i: infor.item_id
								}
							})
						}else{
							//外出报备自己详情
							mui.openWindow({
								url: 'leaveDetails.html', //通过URL传参
								id: 'leaveDetails.html', //通过URL传参
								extras: {
									i: infor.item_id
								}
							})
						}
						break;
					case 10: // 请示报告卡
					case 11: // 情况报告卡
						//item_type=1"情况报告卡"type=2"请示报告卡";
						mui.openWindow({
							url: 'report_card_details.html', //通过URL传参
							id: 'report_card_details.html', //通过URL传参
							extras: {
								item_id: infor.item_id,
								item_type: infor.item_type
							}
						})
						break;
					case 5: // 会议
						//item_type=1会议通知 2会议申请；
						mui.openWindow({
							url: 'meetingDetails.html', //通过URL传参
							id: 'meetingDetails.html', //通过URL传参
							extras: {
								ii: infor.item_id,
								type:infor.item_type
							}
						})
						break;
					default:
						//mui.toast("系统通知");
						break;
				}
				
				try{
					plus.runtime.setBadgeNumber(0);
				}catch(e){
					//TODO handle the exception
//					mui.alert("清除数字==="+JSON.stringify(e));
					console.log("清除数字==="+JSON.stringify(e));
				}
			}
		</script>
	</body>
</html>